<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Milit채rische Hierarchie</title>
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- 1. Allgemeines Seiten-Layout --- */
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f4f7f6;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 30px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 1.8rem;
        }

        #chart-container {
            width: 100%;
            overflow-x: auto;
            padding-bottom: 50px;
            text-align: center;
        }

        /* --- 2. Styling der Google Charts Knoten (Cards) --- */
        .google-visualization-orgchart-node {
            background: #ffffff !important;
            border: none !important;
            border-radius: 8px !important;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1), 0 1px 3px rgba(0,0,0,0.08) !important;
            padding: 15px 20px !important;
            width: 160px;
            transition: all 0.3s ease;
            cursor: pointer;
            color: #333;
        }

        .google-visualization-orgchart-node:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15), 0 3px 6px rgba(0,0,0,0.10) !important;
            border-top: 4px solid #3498db !important;
        }

        .google-visualization-orgchart-node-medium {
            font-size: 1rem;
            font-weight: bold;
        }

        .node-name {
            font-weight: 700;
            color: #2c3e50;
            font-size: 1.1rem;
            margin-bottom: 5px;
            display: block;
        }
        
        .node-title {
            font-size: 0.85rem;
            color: #7f8c8d;
            font-weight: 400;
        }

        /* --- 3. Styling der Verbindungslinien --- */
        .google-visualization-orgchart-lineleft, 
        .google-visualization-orgchart-lineright, 
        .google-visualization-orgchart-linebottom {
            border-color: #bdc3c7 !important;
            border-width: 2px !important;
        }
    </style>
</head>
<body>

    <h1>Hierarchie des serbischen Milit채rs</h1>
    
    <div id="chart-container">
        <div id="tree"></div>
    </div>

    <script>
        google.charts.load('current', {packages:["orgchart"]});
        google.charts.setOnLoadCallback(fetchData);

        async function fetchData() {
            try {
                // UPDATE: Hier verwenden wir die volle URL inkl. Port.
                // Das funktioniert sowohl beim Aufruf 체ber den Server als auch bei lokalen Tests.
                const response = await fetch('http://localhost:3100/hierarchy');
                
                if (!response.ok) throw new Error(response.statusText);
                const data = await response.json();
                renderChart(data);
            } catch (error) {
                console.error('Fehler:', error);
                document.getElementById('tree').innerHTML = `
                    <p style="color:red; font-weight:bold;">
                        Konnte Daten nicht laden: ${error.message}<br>
                        <small>L채uft der Server auf Port 3100?</small>
                    </p>`;
            }
        }

        function renderChart(apiData) {
            if (!apiData || apiData.length === 0) return;

            const dataTable = new google.visualization.DataTable();
            dataTable.addColumn('string', 'Name'); 
            dataTable.addColumn('string', 'Manager'); 
            dataTable.addColumn('string', 'ToolTip');

            const rows = apiData.map(item => {
                const nodeId = String(item.id);
                const parentId = item.parent_id ? String(item.parent_id) : '';

                const contentHtml = `
                    <div class="node-content">
                        <span class="node-name">${item.name}</span>
                    </div>
                `;

                return [
                    { v: nodeId, f: contentHtml },
                    parentId,
                    item.name
                ];
            });

            dataTable.addRows(rows);

            const chart = new google.visualization.OrgChart(document.getElementById("tree"));
            
            const options = {
                allowHtml: true,
                allowCollapse: true,
                size: 'medium',
                selectionColor: 'transparent' 
            };

            chart.draw(dataTable, options);
        }
    </script>
</body>
</html>